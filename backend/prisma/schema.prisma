generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model address {
  address_id      Int               @id @default(autoincrement())
  building_id     Int?
  flat_no         String?           @db.VarChar(20)
  building        building?         @relation(fields: [building_id], references: [building_id], onDelete: Cascade)
  bill            bill[]
  citizen_address citizen_address[]

  @@unique([building_id, flat_no])
}

model bill {
  bill_id    Int       @id @default(autoincrement())
  address_id Int?
  utility_id Int?
  units      Int?
  amount     Decimal?  @db.Decimal(10, 2)
  due_date   DateTime? @db.Date
  status     String?   @db.VarChar(50)
  address    address?  @relation(fields: [address_id], references: [address_id], onDelete: Cascade)
  utility    utility?  @relation(fields: [utility_id], references: [utility_id], onDelete: Cascade)
}

model building {
  building_id   Int            @id @default(autoincrement())
  building_name String?        @db.VarChar(100)
  type_id       Int?
  street        String?        @db.VarChar(100)
  zone          String?        @db.VarChar(100)
  pincode       String?        @db.VarChar(10)
  address       address[]
  building_type building_type? @relation(fields: [type_id], references: [type_id], onDelete: Cascade)
}

model building_type {
  type_id   Int        @id @default(autoincrement())
  type_name String?    @unique @db.VarChar(50)
  category  String?    @db.VarChar(50)
  building  building[]
}

model citizen {
  citizen_id      Int               @id @default(autoincrement())
  full_name       String?           @db.VarChar(100)
  phone           String?           @db.VarChar(15)
  gender          String?           @db.Char(1)
  dob             DateTime?         @db.Date
  citizen_address citizen_address[]
  login           login[]
  notifications   notifications[]
  request         request[]
}

model citizen_address {
  citizen_id Int
  address_id Int
  role       String? @db.VarChar(20)
  address    address @relation(fields: [address_id], references: [address_id], onDelete: Cascade)
  citizen    citizen @relation(fields: [citizen_id], references: [citizen_id], onDelete: Cascade)

  @@id([citizen_id, address_id])
}

model department {
  dept_id   Int       @id @default(autoincrement())
  dept_name String?   @unique @db.VarChar(100)
  utility   utility[]
}

model utility {
  utility_id      Int         @id @default(autoincrement())
  type            String?     @db.VarChar(50)
  charge_per_unit Decimal?    @db.Decimal(10, 2)
  dept_id         Int?
  bill            bill[]
  department      department? @relation(fields: [dept_id], references: [dept_id], onDelete: Cascade)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model login {
  login_id      Int             @id @default(autoincrement())
  citizen_id    Int?
  email         String?         @unique @db.VarChar(100)
  password      String?         @db.VarChar(100)
  role          String?         @default("CITIZEN") @db.VarChar(20)
  citizen       citizen?        @relation(fields: [citizen_id], references: [citizen_id], onDelete: NoAction, onUpdate: NoAction)
  notifications notifications[]
}

model notifications {
  notification_id Int       @id @default(autoincrement())
  login_id        Int
  citizen_id      Int?
  type            String    @db.VarChar(50)
  type_id         Int
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  citizen         citizen?  @relation(fields: [citizen_id], references: [citizen_id], onDelete: NoAction, onUpdate: NoAction)
  login           login     @relation(fields: [login_id], references: [login_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([citizen_id], map: "idx_notifications_citizen_id")
  @@index([login_id], map: "idx_notifications_login_id")
  @@index([type, type_id], map: "idx_notifications_type_typeid")
}

model request {
  request_id   Int       @id @default(autoincrement())
  citizen_id   Int
  service_type String?   @db.VarChar(100)
  details      String?
  status       String?   @default("PENDING") @db.VarChar(50)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
  comment      String?
  citizen      citizen   @relation(fields: [citizen_id], references: [citizen_id], onDelete: Cascade, map: "fk_request_citizen")
}

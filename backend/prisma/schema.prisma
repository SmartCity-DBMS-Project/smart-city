generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model address {
  address_id      Int               @id
  building_id     Int?
  street          String?           @db.VarChar(100)
  zone            String?           @db.VarChar(50)
  flat_no         String?           @db.VarChar(20)
  city            String?           @db.VarChar(50)
  pincode         String?           @db.VarChar(10)
  building        building?         @relation(fields: [building_id], references: [build_id], onDelete: Cascade)
  bill            bill[]
  citizen_address citizen_address[]

  @@unique([building_id, flat_no])
}

model bill {
  bill_id    Int       @id
  address_id Int?
  utility_id Int?
  units      Int?
  amount     Decimal?  @db.Decimal(10, 2)
  due_date   DateTime? @db.Date
  status     String?   @db.VarChar(50)
  address    address?  @relation(fields: [address_id], references: [address_id], onDelete: Cascade)
  utility    utility?  @relation(fields: [utility_id], references: [utility_id], onDelete: Cascade)
}

model building {
  build_id      Int            @id
  b_name        String?        @db.VarChar(100)
  type_id       Int?
  address       address[]
  building_type building_type? @relation(fields: [type_id], references: [type_id], onDelete: Cascade)
}

model building_type {
  type_id   Int        @id
  type_name String?    @unique @db.VarChar(50)
  category  String?    @db.VarChar(50)
  building  building[]
}

model citizen {
  citizen_id      Int               @id
  full_name       String?           @db.VarChar(100)
  username        String?           @unique @db.VarChar(50)
  password_hash   String?           @db.VarChar(255)
  phone           String?           @db.VarChar(15)
  gender          String?           @db.Char(1)
  dob             DateTime?         @db.Date
  citizen_address citizen_address[]
}

model citizen_address {
  citizen_id Int
  address_id Int
  role       String?   @db.VarChar(20)
  start_date DateTime? @db.Date
  end_date   DateTime? @db.Date
  address    address   @relation(fields: [address_id], references: [address_id], onDelete: Cascade)
  citizen    citizen   @relation(fields: [citizen_id], references: [citizen_id], onDelete: Cascade)

  @@id([citizen_id, address_id])
}

model department {
  dept_id   Int       @id
  dept_name String?   @unique @db.VarChar(100)
  utility   utility[]
}

model utility {
  utility_id      Int         @id
  type            String?     @db.VarChar(50)
  charge_per_unit Decimal?    @db.Decimal(10, 2)
  dept_id         Int?
  bill            bill[]
  department      department? @relation(fields: [dept_id], references: [dept_id], onDelete: Cascade)
}
